/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/@microsoft/signalr@8.0.7/dist/esm/FetchHttpClient.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{AbortError,HttpError,TimeoutError}from"./Errors";import{HttpClient,HttpResponse}from"./HttpClient";import{LogLevel}from"./ILogger";import{Platform,getGlobalThis,isArrayBuffer}from"./Utils";export class FetchHttpClient extends HttpClient{constructor(e){if(super(),this._logger=e,"undefined"==typeof fetch||Platform.isNode){const e="function"==typeof __webpack_require__?__non_webpack_require__:require;this._jar=new(e("tough-cookie").CookieJar),"undefined"==typeof fetch?this._fetchType=e("node-fetch"):this._fetchType=fetch,this._fetchType=e("fetch-cookie")(this._fetchType,this._jar)}else this._fetchType=fetch.bind(getGlobalThis());if("undefined"==typeof AbortController){const e="function"==typeof __webpack_require__?__non_webpack_require__:require;this._abortControllerType=e("abort-controller")}else this._abortControllerType=AbortController}async send(e){if(e.abortSignal&&e.abortSignal.aborted)throw new AbortError;if(!e.method)throw new Error("No method defined.");if(!e.url)throw new Error("No url defined.");const t=new this._abortControllerType;let r;e.abortSignal&&(e.abortSignal.onabort=()=>{t.abort(),r=new AbortError});let o,n=null;if(e.timeout){const o=e.timeout;n=setTimeout((()=>{t.abort(),this._logger.log(LogLevel.Warning,"Timeout from HTTP request."),r=new TimeoutError}),o)}""===e.content&&(e.content=void 0),e.content&&(e.headers=e.headers||{},isArrayBuffer(e.content)?e.headers["Content-Type"]="application/octet-stream":e.headers["Content-Type"]="text/plain;charset=UTF-8");try{o=await this._fetchType(e.url,{body:e.content,cache:"no-cache",credentials:!0===e.withCredentials?"include":"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",...e.headers},method:e.method,mode:"cors",redirect:"follow",signal:t.signal})}catch(e){if(r)throw r;throw this._logger.log(LogLevel.Warning,`Error from HTTP request. ${e}.`),e}finally{n&&clearTimeout(n),e.abortSignal&&(e.abortSignal.onabort=null)}if(!o.ok){const e=await deserializeContent(o,"text");throw new HttpError(e||o.statusText,o.status)}const i=deserializeContent(o,e.responseType),a=await i;return new HttpResponse(o.status,o.statusText,a)}getCookieString(e){let t="";return Platform.isNode&&this._jar&&this._jar.getCookies(e,((e,r)=>t=r.join("; "))),t}}function deserializeContent(e,t){let r;switch(t){case"arraybuffer":r=e.arrayBuffer();break;case"text":default:r=e.text();break;case"blob":case"document":case"json":throw new Error(`${t} is not supported.`)}return r}
//# sourceMappingURL=/sm/ae37003aa6a1839ba9935218086ddea3a6a3c1622e184ffec03e8bab48824fdb.map