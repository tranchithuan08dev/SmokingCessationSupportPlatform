/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/@microsoft/signalr@8.0.7/dist/cjs/FetchHttpClient.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FetchHttpClient=void 0;const Errors_1=require("./Errors"),HttpClient_1=require("./HttpClient"),ILogger_1=require("./ILogger"),Utils_1=require("./Utils");class FetchHttpClient extends HttpClient_1.HttpClient{constructor(e){if(super(),this._logger=e,"undefined"==typeof fetch||Utils_1.Platform.isNode){const e="function"==typeof __webpack_require__?__non_webpack_require__:require;this._jar=new(e("tough-cookie").CookieJar),"undefined"==typeof fetch?this._fetchType=e("node-fetch"):this._fetchType=fetch,this._fetchType=e("fetch-cookie")(this._fetchType,this._jar)}else this._fetchType=fetch.bind((0,Utils_1.getGlobalThis)());if("undefined"==typeof AbortController){const e="function"==typeof __webpack_require__?__non_webpack_require__:require;this._abortControllerType=e("abort-controller")}else this._abortControllerType=AbortController}async send(e){if(e.abortSignal&&e.abortSignal.aborted)throw new Errors_1.AbortError;if(!e.method)throw new Error("No method defined.");if(!e.url)throw new Error("No url defined.");const t=new this._abortControllerType;let r;e.abortSignal&&(e.abortSignal.onabort=()=>{t.abort(),r=new Errors_1.AbortError});let o,i=null;if(e.timeout){const o=e.timeout;i=setTimeout((()=>{t.abort(),this._logger.log(ILogger_1.LogLevel.Warning,"Timeout from HTTP request."),r=new Errors_1.TimeoutError}),o)}""===e.content&&(e.content=void 0),e.content&&(e.headers=e.headers||{},(0,Utils_1.isArrayBuffer)(e.content)?e.headers["Content-Type"]="application/octet-stream":e.headers["Content-Type"]="text/plain;charset=UTF-8");try{o=await this._fetchType(e.url,{body:e.content,cache:"no-cache",credentials:!0===e.withCredentials?"include":"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",...e.headers},method:e.method,mode:"cors",redirect:"follow",signal:t.signal})}catch(e){if(r)throw r;throw this._logger.log(ILogger_1.LogLevel.Warning,`Error from HTTP request. ${e}.`),e}finally{i&&clearTimeout(i),e.abortSignal&&(e.abortSignal.onabort=null)}if(!o.ok){const e=await deserializeContent(o,"text");throw new Errors_1.HttpError(e||o.statusText,o.status)}const n=deserializeContent(o,e.responseType),s=await n;return new HttpClient_1.HttpResponse(o.status,o.statusText,s)}getCookieString(e){let t="";return Utils_1.Platform.isNode&&this._jar&&this._jar.getCookies(e,((e,r)=>t=r.join("; "))),t}}function deserializeContent(e,t){let r;switch(t){case"arraybuffer":r=e.arrayBuffer();break;case"text":default:r=e.text();break;case"blob":case"document":case"json":throw new Error(`${t} is not supported.`)}return r}exports.FetchHttpClient=FetchHttpClient;
//# sourceMappingURL=/sm/976b8cdda834b7d88f4a7b6551d730aa3bfdf186d76f84d2aebb31f893404ed2.map