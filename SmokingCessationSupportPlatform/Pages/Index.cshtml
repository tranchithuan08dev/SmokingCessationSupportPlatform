@page
@model IndexModel
@{
    ViewData["Title"] = "Home Page";
    var Member = ViewData["Member"] as SmokingCessationSupportPlatform.BusinessObjects.Models.User;
    var QuitProgressList = ViewData["QuitProgressList"] as List<SmokingCessationSupportPlatform.BusinessObjects.Models.QuitProgress>;
    var AchievementList = ViewData["Achievements"] as List<SmokingCessationSupportPlatform.BusinessObjects.Models.Achievement>;
    var Quote = ViewData["MotivationalQuote"] as string;
    var totalDays = QuitProgressList?.Sum(p => p.DaysSmokingFree ?? 0) ?? 0;
    var totalSaved = QuitProgressList?.Sum(p => p.MoneySaved ?? 0) ?? 0;
}

<div class="container mt-5">
    <div class="row align-items-center">
        <div class="col-md-6">
            <div id="smokingPosterCarousel" class="carousel slide rounded shadow" data-bs-ride="carousel" data-bs-interval="3000">
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <img src="~/image/Background.webp" class="d-block " alt="Stop Smoking Poster 1" />
                    </div>
                    <div class="carousel-item">
                        <img src="~/image/Poster2.webp" class="d-block" alt="Stop Smoking Poster 2" />
                    </div>
                    <div class="carousel-item">
                        <img src="~/image/Poster3.jpg" class="d-block" alt="Stop Smoking Poster 3" />
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="text-white bg-dark bg-opacity-75 p-4 rounded shadow custom-jumbotron">
                <h1 class="display-4">Welcome to the Smoking Cessation Support Platform!</h1>
                <p class="lead">Your journey to quit smoking starts here.</p>
                <hr class="my-4 border-light" />
                <p>We provide the tools and resources you need to achieve a healthier life.</p>
                <a class="btn btn-primary btn-lg mt-3" href="#" role="button">Learn More</a>
            </div>
        </div>
    </div>
</div>

<div class="container mt-5">
    <div class="row">
        <div class="col-md-4">
            <h2>Community Support</h2>
            <p>Connect with like-minded individuals, share experiences, and get encouragement from our community.</p>
            <p><a class="btn btn-secondary" href="#" role="button">Join Now &raquo;</a></p>
        </div>
        <div class="col-md-4">
            <h2>Learning Resources</h2>
            <p>Access detailed articles, videos, and guides on effective smoking cessation methods.</p>
            <p><a class="btn btn-secondary" href="#" role="button">Explore &raquo;</a></p>
        </div>
        <div class="col-md-4">
            <h2>Personalized Plan</h2>
            <p>Build a tailored quit plan, track your progress, and get expert advice.</p>
            <p><a class="btn btn-secondary" href="#" role="button">Start Your Plan &raquo;</a></p>
        </div>
    </div>
    <hr>
</div>
@if (TempData["ShowWelcomeModal"] != null && Member != null)
{
    <div class="modal fade" id="welcomeModal" tabindex="-1" aria-labelledby="welcomeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title" id="welcomeModalLabel">Welcome back, @Member.Username! 🎉</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <div class="modal-body">
                    @* --- Câu động viên --- *@
                    @if (!string.IsNullOrEmpty(Quote))
                    {
                        <div class="alert alert-info">
                            <strong>💬 Motivation:</strong> <em>@Quote</em>
                        </div>
                    }

                    @* --- Tổng quan tiến trình --- *@
                    <h5 class="mt-3">🚭 Your Quit Progress</h5>

                    <p>
                        <strong>Total Smoke-Free Days:</strong> @totalDays days<br />
                        <strong>Total Money Saved:</strong> @totalSaved.ToString("C0", new System.Globalization.CultureInfo("vi-VN"))
                    </p>

                    @if (QuitProgressList != null && QuitProgressList.Any())
                    {
                        <ul class="list-group mb-3">
                            @foreach (var progress in QuitProgressList)
                            {
                                <li class="list-group-item">
                                    <strong>Date:</strong> @(progress.ReportDate?.ToString("dd/MM/yyyy") ?? "N/A") |
                                    <strong>Days:</strong> @progress.DaysSmokingFree |
                                    <strong>Saved:</strong> @(progress.MoneySaved?.ToString("C0", new System.Globalization.CultureInfo("vi-VN")) ?? "0 ₫")
                                </li>
                            }
                        </ul>
                    }

                    @* --- Danh sách thành tích --- *@
                    @if (AchievementList != null && AchievementList.Any())
                    {
                        <h5 class="mt-3">🏆 Your Achievements</h5>
                        <ul class="list-group">
                            @foreach (var ua in AchievementList)
                            {
                                <li class="list-group-item d-flex align-items-center">
                                    @* Icon bên trái *@
                                    @if (!string.IsNullOrEmpty(ua.IconUrl))
                                    {
                                        <img src="@ua.IconUrl" alt="Icon" class="me-3" style="width: 40px; height: 40px;" />
                                    }

                                    <div>
                                        <strong>@ua.AchievementName</strong><br />
                                        <span class="small text-muted">@ua.Description</span>
                                    </div>
                                </li>
                            }
                        </ul>
                    }
                </div>

                <div class="modal-footer">
                    <a class="btn btn-primary" href="/QuitProgress/Track">Track Your Progress</a>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        window.onload = function () {
            var welcomeModal = new bootstrap.Modal(document.getElementById('welcomeModal'));
            welcomeModal.show();
        };
    </script>
}
